---
title: "California 2022 Proposition 30"
author: "GitData"
date: "10/21/2022"
output:
  html_document:
    toc: yes
    toc_depth: '5'
    df_print: paged
  pdf_document:
    toc: yes
    toc_depth: 5
---

\clearpage
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library(knitr)
library(ggplot2)
library(dplyr)
library(GGally)
library(lmtest)
library(car)
library(onewaytests)
library(ggiraph)
library(ggiraphExtra)
library(plyr)
library(ggpubr)
```

# I. Introduction and Research Questions

California has been a pioneer in U.S. air quality legislation since the 1940s. In 2006 California passed Assembly Bill 32 (AB 32), which created a comprehensive, multi-year program to reduce greenhouse gas (GHG) emissions in California. In 2050, the emission of greenhouse gas should be cut to 80% below the 1990 level. According to the California Air Resource Board, transportation produced about 41% of greenhouse gas emissions in 2019. Moreover, the California Air Resource Board reported that the wildfire produced 106.7 million tons of carbon dioxide in 2020 and 85.1 million tons in 2021. The state wants to decrease greenhouse gas emissions by having more electric cars and preventing wildfires. This is what Proposition 30 is going to do.

Proposition 30 is going to increase a 1.75% tax on Californians who earn above $2 million per year to fund programs to reduce greenhouse gas emissions and prevent wildfires. The tax plans to start in 2023 and will end by 2043 or earlier if we can maintain the expected amount of greenhouse gas emissions for three consecutive calendar years.

80 percent of the tax revenue will be invested in the Zero Emission Vehicle (ZEV) program. Specifically, 45 percent in helping people buy electric vehicles and 35 percent in installing more charging stations. The state government decided to dedicate an additional $10 billion over the next five years to the program in this yearâ€™s budget.

20 percent of the tax revenue will be spent on Wildfire Response and Prevention Programs. In general, most of this money will be used to hire, train, and retain state firefighters. The rest of the money could be used for other wildfire response and prevention activities.

We will figure out whether more electric vehicles can help reduce greenhouse gas emissions. Based on the tax revenue and the additional $10 billion funded by the government, we will find out how many electric vehicles can be used and the amount of greenhouse gas that can be reduced. We will find out how much greenhouse gas can be reduced after funding the Wildfire Response and Prevention Programs. Finally, we will evaluate if our goal can be achieved, which is whether greenhouse gas emissions can be cut to 80% below the 1990 level by 2050.

# II. Data Description & Visualization

Before doing the analysis, it is necessary to introduce and visualize the datasets we will use. Generally speaking, we have four major datasets to analyze.

## 1. EMission FACtor (EMFAC) 2021

```{r, include=FALSE}
#########################################################
###II. Data Description & Visualization##################
#########################################################
# Load the 1st dataset
pollution = read.csv("https://caelection2022.gitdata.ga/dataset/EMFAC2021-EI-202x.csv", 
                     header = TRUE)
# Pollution per mile per car
pollutionAVG = pollution %>% 
               mutate(CO2_AVG = CO2_RUNEX / Total.VMT / 1000000,
                      CH4_AVG = CH4_RUNEX / Total.VMT / 1000000,
                      N2O_AVG = N2O_RUNEX / Total.VMT / 1000000,
                      GHG_AVG = (CO2_RUNEX + CH4_RUNEX + N2O_RUNEX) / Total.VMT / 1000000)
```

The first dataset we use is from the California Air Resource Board called EMission FACtor (EMFAC) 2021, which is the official emissions inventory of on-road mobile sources in California. We only consider light-duty vehicles (passenger cars) because the proposition only helps individuals to buy electric vehicles.

According to the United States Environmental Protection Agency (EPA), greenhouse gas is mainly composed of Carbon dioxide, Methane, and Nitrous oxide, so we only consider these three pollutants in our analysis against the fuel types of cars. In order to analyze more accurately, we use the average emission of Carbon dioxide, Methane, and Nitrous oxide per mile per car in a year to be our response variables. We also add up these three pollutants as the average amount of greenhouse gas emitted per mile per car in a year. The following are descriptions of the variables we used. 

- `Fuel`: The types of fuel each car uses. There are four types of fuel: `Diesel` (37,968 counts), `Electricity` (27,314 counts), `Gasoline` (40,140 counts), and `Plug-in Hybrid` (11,604 counts).

- `CO2_AVG`: The amount of Carbon dioxide, in million metric tons, emitted per mile per car in 2021.

- `CH4_AVG`: The amount of Methane, in million metric tons, emitted per mile per car in 2021.

- `N2O_AVG`: The amount of Nitrous oxide, in million metric tons, emitted per mile per car in 2021.

- `GHG_AVG`: The amount of greenhouse gas (the sum of Carbon dioxide, Methane, and Nitrous oxide), in million metric tons, emitted per mile per car in 2021.

```{r, include=FALSE}
# Number of passenger cars
num_car = nrow(pollutionAVG)
num_car
# Number of cars by fuel types
table(pollutionAVG$Fuel)
# Total CO2
total_co2 = sum(pollutionAVG$CO2_RUNEX / 1000000)
total_co2
# Total CH4
total_ch4 = sum(pollutionAVG$CH4_RUNEX / 1000000)
total_ch4
# Total N2O
total_n2o = sum(pollutionAVG$N2O_RUNEX / 1000000)
total_n2o
# Total greenhouse gas
total_ghg = sum(pollutionAVG$CO2_RUNEX / 1000000) + 
            sum(pollutionAVG$CH4_RUNEX / 1000000) +
            sum(pollutionAVG$N2O_RUNEX / 1000000)
total_ghg
```

```{r, echo=FALSE}
# Visualization
ggplot(pollutionAVG, aes(x=Fuel, y=CO2_AVG)) + 
  geom_boxplot() + labs(y = "CO2 (million tons per mile)")
ggplot(pollutionAVG, aes(x=Fuel, y=CH4_AVG)) + 
  geom_boxplot() + labs(y = "CH4 (million tons per mile)")
ggplot(pollutionAVG, aes(x=Fuel, y=N2O_AVG)) + 
  geom_boxplot() + labs(y = "N2O (million tons per mile)")
ggplot(pollutionAVG, aes(x=Fuel, y=GHG_AVG)) + 
  geom_boxplot() + labs(y = "GHG (million tons per mile)")
```

```{r, echo=FALSE}
ggplot(pollutionAVG, aes(y = CO2_AVG, x = Fuel)) +
  geom_bar(stat='identity') + labs(y = "CO2 (million tons per mile)")
ggplot(pollutionAVG, aes(y = CH4_AVG, x = Fuel)) +
  geom_bar(stat='identity') + labs(y = "CH4 (million tons per mile)")
ggplot(pollutionAVG, aes(y = N2O_AVG, x = Fuel)) +
  geom_bar(stat='identity') + labs(y = "N2O (million tons per mile)")
ggplot(pollutionAVG, aes(y = GHG_AVG, x = Fuel)) +
  geom_bar(stat='identity') + labs(y = "GHG (million tons per mile)")
```

## 2. Personal Income Tax Data 2020

```{r, include=FALSE}
# Load the 2nd dataset
income = read.csv("https://caelection2022.gitdata.ga/dataset/2020_Combined_AR_PIT_B4A.csv", 
                    header = TRUE)
AGI_class = income$Adjusted.Gross.Income.Class[-c(1, 2, 62, 63)]
People_Taxable = as.numeric(gsub(",","",income$X[-c(1, 2, 62, 63)]))
Federal_AGI = as.numeric(gsub(",","",income$Federal.AGI..Thousands.[-c(1, 2, 62, 63)])) * 1000
Class = c(rep("Lower Class", 42), rep("Middle Class", 7), rep("Upper Class", 10))
income_clean = data.frame(AGI_class, People_Taxable, Federal_AGI, Class)
income_clean[is.na(income_clean)] = 0
```

The second dataset is from the Franchise Tax Board of California, which contains the number of taxpayers in California, and the federal adjusted gross income (AGI), which is the figure that the Internal Revenue Service (IRS) uses to determine your income tax liability for the year, for each AGI class. The original unit for AGI is thousand dollars. In order to make our analysis more accurate, we use dollars as the unit for AGI. This is the data in 2020, which is the latest we can get. 

- `Adjusted.Gross.Income.Class`: The groups of people based on their adjusted gross income (59 counts). 

- `Number.of.Return_Taxable`: The number of people who are eligible to be taxed (11,332,757 counts). 

- `Federal.AGI`: The adjusted gross income, in dollars, of each AGI class. 

```{r, include=FALSE}
# Total people taxable 2020
sum(income_clean$People_Taxable)
# Total AGI 2020
sum(income_clean$Federal_AGI)
# Calculate the tax revenue generated by the 1.75% tax
people_200m = income_clean$Federal_AGI[c(56, 57, 58, 59)]
people_200m
AGI_200m = sum(people_200m)
AGI_200m
tax_revenue = AGI_200m * 0.0175
tax_revenue
```

## 3. Sales of ZEV 2021

```{r, include=FALSE}
carSale = read.csv("https://caelection2022.gitdata.ga/dataset/New_ZEV_Sales_County.csv", 
                    header = TRUE)
carSale_2021 = carSale %>% 
               filter(Data.Year == "2021")
```

The third dataset is from the California Energy Commission, which contains the sale of ZEV cars from 1998 to October 18, 2022, in each county, by fuel types, makes, and models. For consistency of the analysis, we only consider the car sale in 2021.

- `Data.Year`: The year of how many cars were sold from 1998 to October 18, 2022.

- `FUEL_TYPE`: It includes three types: Electric (6,539 counts), Hydrogen (417), and PHEV (Plug-in hybrid electric vehicle) (7,975 counts).

- `Number.of.Vehicles`: It lists the number of sales of every vehicle in each county, by fuel types, makes, and models.

```{r, include=FALSE}
aggregate(carSale_2021$Number.of.Vehicles, 
          by=list(Category=carSale_2021$FUEL_TYPE), FUN=sum)
```

4. Wildfire Response and Prevention Programs fundings

```{r}
budget = read.csv("https://caelection2022.gitdata.ga/dataset/Historical_Expenditures.csv", 
                    header = TRUE)
budget_clean = budget %>%
               filter(Department %in% c("Office of the State Fire Marshall", 
                                        "Department of Forestry and Fire Protection"))
budget_clean = budget_clean %>%
               filter(Fund %in% c("General Fund", "Special Funds")) %>%
               arrange(desc(Amount))
budget_clean = budget_clean[1:160,] %>% arrange(desc(Fiscal.Year))
budget_clean = budget_clean[-c(1:5, 86:160),]
budget_clean$Amount = gsub(",","",budget_clean$Amount)
budget_clean$Amount = as.numeric(gsub("\\$","",budget_clean$Amount)) * 1000
budget_clean = as.data.frame(aggregate(budget_clean$Amount, 
                             by=list(Category=budget_clean$Fiscal.Year), FUN=sum))
Fire_CO2 = c(5.4, 6.7, 13.5, 19.7, 5.7, 2.6, 13.5, 20.0, 42.8, 9.2, 1.9, 3.1, 
             11.4, 14.7, 17.2, 19.2, 10.5, 31.3, 13.1, 4.8, 106.7, 85.1)
budget_clean$Fire_CO2 = Fire_CO2
colnames(budget_clean) <- c('Year','Fund','CO2')
```

We collect data about two types of funds: Special funds and General fund from the government to the two departments Office of the State Fire Marshall and Department of Forestry and Fire Protection from 2000-2021 and the corresponding Carbon dioxide. 

Special funds are established by a government to collect money that must be used for a specific project. General fund is the primary fund used by a government entity. 

Office of the State Fire Marshall (OSFM)â€™s purpose is to protect life and property through the development and application of fire prevention, engineering, training and education, and enforcement. The Department of Forestry and Fire Protection serves and safeguards the people and protects the property and resources of California. 

- `CO2`: The amount of Carbon dioxide produced by wildfires from 2000 to 2021. 

- `Fund`: The money funded, in dollars, by the government to the Office of the State Fire Marshall and the Department of Forestry and Fire Protection each year from 2000 to 2021.


```{r}
summary(lm(CO2 ~ Fund, data = budget_clean))
```




# III. Analysis

```{r}
################################################
##########III. Data Visualization###############
################################################
# Linear regression for CO2
co2.model.avg = lm(CO2_AVG ~ as.character(Fuel), data = pollutionAVG)
summary(co2.model.avg)
```

```{r}
# Linear regression for CH4
ch4.model.avg = lm(CH4_AVG ~ as.character(Fuel), data = pollutionAVG)
summary(ch4.model.avg)
```

```{r}
# Linear regression for N2O
n2o.model.avg = lm(N2O_AVG ~ as.character(Fuel), data = pollutionAVG)
summary(n2o.model.avg)
```

```{r}
# Linear regression for GHG
ghg.model.avg = lm(GHG_AVG ~ as.character(Fuel), data = pollutionAVG)
summary(ghg.model.avg)
```

```{r}
# Amount of money used in each section
buy_car = tax_revenue * 0.45
charging_station = tax_revenue * 0.35
fire_control = tax_revenue * 0.2
# Only for car and charging station in the next 5 years
addition = 10000000000 
addition_car_year = addition / 5 * 0.5625
addition_charging_year = addition / 5 * 0.4375
total_car_2027_year = buy_car + addition_car_year
total_charging_2027_year = charging_station + addition_charging_year
```


# IV. Result and Interpretation

// Type your solution here

# V. Conclusion and Future Discussion

// Type your solution here


\clearpage

# Appendix: R Script

```{r, ref.label=knitr::all_labels(),echo=TRUE,eval=FALSE}
```